#!/bin/bash
# Piko configuration and preset loader
# Source this file in piko scripts

PIKO_CONFIG="${HOME}/.pikorc"
PIKO_STATE_DIR="/var/lib/piko"

load_config() {
    if [ -f "$PIKO_CONFIG" ]; then
        source "$PIKO_CONFIG"
    fi
}

get_preset_domains() {
    local preset_name="$1"
    
    load_config
    
    if [ -z "${PIKO_PRESETS:-}" ]; then
        return
    fi
    
    python3 - "$PIKO_PRESETS" "$preset_name" 2>/dev/null <<'PY'
import json
import sys
presets = json.loads(sys.argv[1])
name = sys.argv[2]
if name in presets:
    print(",".join(presets[name]))
PY
}

list_presets() {
    load_config
    
    if [ -z "${PIKO_PRESETS:-}" ]; then
        echo "No presets configured."
        echo "Edit ~/.pikorc to add presets."
        return
    fi
    
    python3 - "$PIKO_PRESETS" 2>/dev/null <<'PY' || true
import json
import sys
presets = json.loads(sys.argv[1])
for name in presets:
    domains = ", ".join(presets[name][:3])
    if len(presets[name]) > 3:
        domains += f" (+{len(presets[name])-3} more)"
    print(f"  {name:15} - {domains}")
PY
}

get_default_duration() {
    echo "${PIKO_DEFAULT_DURATION:-60}"
}
